---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { getPost, type BlogPost } from '../../lib/api';

const { slug } = Astro.params;

let post: BlogPost | null = null;
let error: string | null = null;

try {
  if (slug) {
    const res = await getPost(slug);
    post = res.data;
  }
} catch (e) {
  error = '文章未找到';
}
---

<BaseLayout title={post?.title || '文章'}>
  {error || !post ? (
    <div class="card text-center text-gray-500 py-12">
      <p class="text-lg">{error || '文章不存在'}</p>
      <a href="/blog" class="mt-4 inline-block text-primary-600 hover:underline">← 返回博客列表</a>
    </div>
  ) : (
    <article class="prose prose-gray mx-auto max-w-3xl">
      <a href="/blog" class="text-sm text-gray-500 hover:text-primary-600 no-underline">← 返回博客列表</a>
      <h1 class="mt-4">{post.title}</h1>
      {post.published_at && (
        <time class="text-sm text-gray-400">
          {new Date(post.published_at).toLocaleDateString('zh-CN', {
            year: 'numeric', month: 'long', day: 'numeric',
          })}
        </time>
      )}
      <div class="mt-8 whitespace-pre-wrap" set:html={post.content} />
    </article>
  )}
</BaseLayout>
