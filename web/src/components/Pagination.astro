---
/**
 * Pagination — 通用分页组件
 * Props:
 *   currentPage: 当前页码
 *   totalPages:  总页数
 *   baseUrl:     基础 URL (不含 ?page= 参数)
 */
interface Props {
  currentPage: number;
  totalPages: number;
  baseUrl: string;
}

const { currentPage, totalPages, baseUrl } = Astro.props;

// Build page numbers with ellipsis
function getPageNumbers(current: number, total: number): (number | '...')[] {
  if (total <= 7) {
    return Array.from({ length: total }, (_, i) => i + 1);
  }

  const pages: (number | '...')[] = [1];

  if (current > 3) pages.push('...');

  const start = Math.max(2, current - 1);
  const end = Math.min(total - 1, current + 1);

  for (let i = start; i <= end; i++) {
    pages.push(i);
  }

  if (current < total - 2) pages.push('...');

  pages.push(total);
  return pages;
}

const pages = getPageNumbers(currentPage, totalPages);

function pageUrl(page: number): string {
  const sep = baseUrl.includes('?') ? '&' : '?';
  return `${baseUrl}${sep}page=${page}`;
}
---

{totalPages > 1 && (
  <nav class="mt-8 flex items-center justify-center gap-1" aria-label="分页导航">
    {/* Previous */}
    {currentPage > 1 ? (
      <a href={pageUrl(currentPage - 1)}
         class="rounded-lg px-3 py-2 text-sm text-gray-600 hover:bg-gray-100 transition-colors">
        ← 上一页
      </a>
    ) : (
      <span class="rounded-lg px-3 py-2 text-sm text-gray-300 cursor-not-allowed">
        ← 上一页
      </span>
    )}

    {/* Page numbers */}
    {pages.map((p) =>
      p === '...' ? (
        <span class="px-2 py-2 text-sm text-gray-400">…</span>
      ) : p === currentPage ? (
        <span class="rounded-lg bg-primary-600 px-3.5 py-2 text-sm font-medium text-white">
          {p}
        </span>
      ) : (
        <a href={pageUrl(p)}
           class="rounded-lg px-3.5 py-2 text-sm text-gray-600 hover:bg-gray-100 transition-colors">
          {p}
        </a>
      )
    )}

    {/* Next */}
    {currentPage < totalPages ? (
      <a href={pageUrl(currentPage + 1)}
         class="rounded-lg px-3 py-2 text-sm text-gray-600 hover:bg-gray-100 transition-colors">
        下一页 →
      </a>
    ) : (
      <span class="rounded-lg px-3 py-2 text-sm text-gray-300 cursor-not-allowed">
        下一页 →
      </span>
    )}
  </nav>
)}
