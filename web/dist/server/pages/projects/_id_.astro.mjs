/* empty css                                     */
import { f as createAstro, g as createComponent, r as renderTemplate, k as defineScriptVars, i as addAttribute, m as maybeRenderHead, j as renderComponent } from '../../chunks/astro/server_CCdsDrdo.mjs';
import 'kleur/colors';
import { $ as $$BaseLayout } from '../../chunks/BaseLayout_CnYfUBOf.mjs';
import 'clsx';
import { c as getProject } from '../../chunks/api_CbtYqGEw.mjs';
export { renderers } from '../../renderers.mjs';

var __freeze = Object.freeze;
var __defProp = Object.defineProperty;
var __template = (cooked, raw) => __freeze(__defProp(cooked, "raw", { value: __freeze(raw || cooked.slice()) }));
var _a;
const $$Astro$1 = createAstro("https://tishi.dev");
const $$TrendChart = createComponent(async ($$result, $$props, $$slots) => {
  const Astro2 = $$result.createAstro($$Astro$1, $$props, $$slots);
  Astro2.self = $$TrendChart;
  const { projectId, projectName } = Astro2.props;
  return renderTemplate(_a || (_a = __template(["", '<div class="trend-chart-container"', '> <div class="flex items-center justify-between mb-4"> <h2 class="text-lg font-semibold text-gray-900">\u{1F4C8} \u8D8B\u52BF\u56FE \u2014 ', '</h2> <div class="flex gap-2"> <button data-days="7" class="trend-btn text-xs px-3 py-1 rounded-full border border-gray-300 text-gray-600 hover:bg-gray-100 transition-colors">7 \u5929</button> <button data-days="30" class="trend-btn text-xs px-3 py-1 rounded-full bg-primary-600 text-white">30 \u5929</button> <button data-days="90" class="trend-btn text-xs px-3 py-1 rounded-full border border-gray-300 text-gray-600 hover:bg-gray-100 transition-colors">90 \u5929</button> </div> </div> <div class="grid gap-4 md:grid-cols-2"> <div class="bg-gray-50 rounded-lg p-4"> <canvas', ' height="200"></canvas> </div> <div class="bg-gray-50 rounded-lg p-4"> <canvas', ' height="200"></canvas> </div> </div> <div class="mt-3 text-center text-xs text-gray-400"', ">\n\u6B63\u5728\u52A0\u8F7D\u8D8B\u52BF\u6570\u636E\u2026\n</div> </div> <script>(function(){", "\n  // Chart.js is loaded via CDN below; this inline script runs after DOM ready\n  async function initTrendChart(pid, days = 30) {\n    const container = document.querySelector(`.trend-chart-container[data-project-id=\"${pid}\"]`);\n    const statusEl = document.getElementById(`chart-status-${pid}`);\n    if (!container || !statusEl) return;\n\n    statusEl.textContent = '\u6B63\u5728\u52A0\u8F7D\u8D8B\u52BF\u6570\u636E\u2026';\n\n    try {\n      const apiBase = '';\n      const res = await fetch(`${apiBase}/api/v1/projects/${pid}/trends?days=${days}`);\n      if (!res.ok) throw new Error(`HTTP ${res.status}`);\n      const json = await res.json();\n      const points = json.data || [];\n\n      if (points.length === 0) {\n        statusEl.textContent = '\u6682\u65E0\u8D8B\u52BF\u6570\u636E\uFF0C\u8BF7\u5148\u8FD0\u884C tishi collect \u5E76\u7B49\u5F85\u6570\u636E\u79EF\u7D2F';\n        return;\n      }\n\n      const labels = points.map(p => {\n        const d = new Date(p.date);\n        return `${d.getMonth() + 1}/${d.getDate()}`;\n      });\n      const starsData = points.map(p => p.stars);\n      const forksData = points.map(p => p.forks);\n\n      // Destroy previous charts if they exist\n      const starsCanvas = document.getElementById(`stars-chart-${pid}`);\n      const forksCanvas = document.getElementById(`forks-chart-${pid}`);\n\n      if (starsCanvas._chart) starsCanvas._chart.destroy();\n      if (forksCanvas._chart) forksCanvas._chart.destroy();\n\n      const Chart = window.Chart;\n      if (!Chart) {\n        statusEl.textContent = 'Chart.js \u672A\u52A0\u8F7D';\n        return;\n      }\n\n      const commonOpts = {\n        responsive: true,\n        maintainAspectRatio: false,\n        interaction: { intersect: false, mode: 'index' },\n        plugins: {\n          legend: { display: false },\n          tooltip: {\n            backgroundColor: 'rgba(0,0,0,0.8)',\n            titleFont: { size: 12 },\n            bodyFont: { size: 11 },\n          },\n        },\n        scales: {\n          x: {\n            grid: { display: false },\n            ticks: { font: { size: 10 }, maxTicksLimit: 10 },\n          },\n          y: {\n            grid: { color: 'rgba(0,0,0,0.04)' },\n            ticks: { font: { size: 10 } },\n          },\n        },\n      };\n\n      starsCanvas._chart = new Chart(starsCanvas, {\n        type: 'line',\n        data: {\n          labels,\n          datasets: [{\n            label: '\u2B50 Stars',\n            data: starsData,\n            borderColor: '#eab308',\n            backgroundColor: 'rgba(234,179,8,0.1)',\n            fill: true,\n            tension: 0.3,\n            pointRadius: points.length > 30 ? 0 : 3,\n          }],\n        },\n        options: { ...commonOpts, plugins: { ...commonOpts.plugins, title: { display: true, text: 'Stars', font: { size: 13 } } } },\n      });\n\n      forksCanvas._chart = new Chart(forksCanvas, {\n        type: 'line',\n        data: {\n          labels,\n          datasets: [{\n            label: '\u{1F374} Forks',\n            data: forksData,\n            borderColor: '#6b7280',\n            backgroundColor: 'rgba(107,114,128,0.1)',\n            fill: true,\n            tension: 0.3,\n            pointRadius: points.length > 30 ? 0 : 3,\n          }],\n        },\n        options: { ...commonOpts, plugins: { ...commonOpts.plugins, title: { display: true, text: 'Forks', font: { size: 13 } } } },\n      });\n\n      statusEl.textContent = `\u6700\u8FD1 ${days} \u5929\u6570\u636E \xB7 \u5171 ${points.length} \u4E2A\u6570\u636E\u70B9`;\n    } catch (err) {\n      statusEl.textContent = '\u52A0\u8F7D\u5931\u8D25\uFF1A' + err.message;\n    }\n  }\n\n  // Button click handlers\n  document.querySelectorAll(`.trend-chart-container[data-project-id=\"${projectId}\"] .trend-btn`).forEach(btn => {\n    btn.addEventListener('click', () => {\n      // Reset button styles\n      document.querySelectorAll(`.trend-chart-container[data-project-id=\"${projectId}\"] .trend-btn`).forEach(b => {\n        b.className = 'trend-btn text-xs px-3 py-1 rounded-full border border-gray-300 text-gray-600 hover:bg-gray-100 transition-colors';\n      });\n      btn.className = 'trend-btn text-xs px-3 py-1 rounded-full bg-primary-600 text-white';\n      initTrendChart(projectId, Number(btn.dataset.days));\n    });\n  });\n\n  // Load Chart.js from CDN if not already loaded, then init\n  function boot() {\n    if (window.Chart) {\n      initTrendChart(projectId, 30);\n    } else {\n      const s = document.createElement('script');\n      s.src = 'https://cdn.jsdelivr.net/npm/chart.js@4/dist/chart.umd.min.js';\n      s.onload = () => initTrendChart(projectId, 30);\n      document.head.appendChild(s);\n    }\n  }\n\n  if (document.readyState === 'loading') {\n    document.addEventListener('DOMContentLoaded', boot);\n  } else {\n    boot();\n  }\n})();<\/script>"], ["", '<div class="trend-chart-container"', '> <div class="flex items-center justify-between mb-4"> <h2 class="text-lg font-semibold text-gray-900">\u{1F4C8} \u8D8B\u52BF\u56FE \u2014 ', '</h2> <div class="flex gap-2"> <button data-days="7" class="trend-btn text-xs px-3 py-1 rounded-full border border-gray-300 text-gray-600 hover:bg-gray-100 transition-colors">7 \u5929</button> <button data-days="30" class="trend-btn text-xs px-3 py-1 rounded-full bg-primary-600 text-white">30 \u5929</button> <button data-days="90" class="trend-btn text-xs px-3 py-1 rounded-full border border-gray-300 text-gray-600 hover:bg-gray-100 transition-colors">90 \u5929</button> </div> </div> <div class="grid gap-4 md:grid-cols-2"> <div class="bg-gray-50 rounded-lg p-4"> <canvas', ' height="200"></canvas> </div> <div class="bg-gray-50 rounded-lg p-4"> <canvas', ' height="200"></canvas> </div> </div> <div class="mt-3 text-center text-xs text-gray-400"', ">\n\u6B63\u5728\u52A0\u8F7D\u8D8B\u52BF\u6570\u636E\u2026\n</div> </div> <script>(function(){", "\n  // Chart.js is loaded via CDN below; this inline script runs after DOM ready\n  async function initTrendChart(pid, days = 30) {\n    const container = document.querySelector(\\`.trend-chart-container[data-project-id=\"\\${pid}\"]\\`);\n    const statusEl = document.getElementById(\\`chart-status-\\${pid}\\`);\n    if (!container || !statusEl) return;\n\n    statusEl.textContent = '\u6B63\u5728\u52A0\u8F7D\u8D8B\u52BF\u6570\u636E\u2026';\n\n    try {\n      const apiBase = '';\n      const res = await fetch(\\`\\${apiBase}/api/v1/projects/\\${pid}/trends?days=\\${days}\\`);\n      if (!res.ok) throw new Error(\\`HTTP \\${res.status}\\`);\n      const json = await res.json();\n      const points = json.data || [];\n\n      if (points.length === 0) {\n        statusEl.textContent = '\u6682\u65E0\u8D8B\u52BF\u6570\u636E\uFF0C\u8BF7\u5148\u8FD0\u884C tishi collect \u5E76\u7B49\u5F85\u6570\u636E\u79EF\u7D2F';\n        return;\n      }\n\n      const labels = points.map(p => {\n        const d = new Date(p.date);\n        return \\`\\${d.getMonth() + 1}/\\${d.getDate()}\\`;\n      });\n      const starsData = points.map(p => p.stars);\n      const forksData = points.map(p => p.forks);\n\n      // Destroy previous charts if they exist\n      const starsCanvas = document.getElementById(\\`stars-chart-\\${pid}\\`);\n      const forksCanvas = document.getElementById(\\`forks-chart-\\${pid}\\`);\n\n      if (starsCanvas._chart) starsCanvas._chart.destroy();\n      if (forksCanvas._chart) forksCanvas._chart.destroy();\n\n      const Chart = window.Chart;\n      if (!Chart) {\n        statusEl.textContent = 'Chart.js \u672A\u52A0\u8F7D';\n        return;\n      }\n\n      const commonOpts = {\n        responsive: true,\n        maintainAspectRatio: false,\n        interaction: { intersect: false, mode: 'index' },\n        plugins: {\n          legend: { display: false },\n          tooltip: {\n            backgroundColor: 'rgba(0,0,0,0.8)',\n            titleFont: { size: 12 },\n            bodyFont: { size: 11 },\n          },\n        },\n        scales: {\n          x: {\n            grid: { display: false },\n            ticks: { font: { size: 10 }, maxTicksLimit: 10 },\n          },\n          y: {\n            grid: { color: 'rgba(0,0,0,0.04)' },\n            ticks: { font: { size: 10 } },\n          },\n        },\n      };\n\n      starsCanvas._chart = new Chart(starsCanvas, {\n        type: 'line',\n        data: {\n          labels,\n          datasets: [{\n            label: '\u2B50 Stars',\n            data: starsData,\n            borderColor: '#eab308',\n            backgroundColor: 'rgba(234,179,8,0.1)',\n            fill: true,\n            tension: 0.3,\n            pointRadius: points.length > 30 ? 0 : 3,\n          }],\n        },\n        options: { ...commonOpts, plugins: { ...commonOpts.plugins, title: { display: true, text: 'Stars', font: { size: 13 } } } },\n      });\n\n      forksCanvas._chart = new Chart(forksCanvas, {\n        type: 'line',\n        data: {\n          labels,\n          datasets: [{\n            label: '\u{1F374} Forks',\n            data: forksData,\n            borderColor: '#6b7280',\n            backgroundColor: 'rgba(107,114,128,0.1)',\n            fill: true,\n            tension: 0.3,\n            pointRadius: points.length > 30 ? 0 : 3,\n          }],\n        },\n        options: { ...commonOpts, plugins: { ...commonOpts.plugins, title: { display: true, text: 'Forks', font: { size: 13 } } } },\n      });\n\n      statusEl.textContent = \\`\u6700\u8FD1 \\${days} \u5929\u6570\u636E \xB7 \u5171 \\${points.length} \u4E2A\u6570\u636E\u70B9\\`;\n    } catch (err) {\n      statusEl.textContent = '\u52A0\u8F7D\u5931\u8D25\uFF1A' + err.message;\n    }\n  }\n\n  // Button click handlers\n  document.querySelectorAll(\\`.trend-chart-container[data-project-id=\"\\${projectId}\"] .trend-btn\\`).forEach(btn => {\n    btn.addEventListener('click', () => {\n      // Reset button styles\n      document.querySelectorAll(\\`.trend-chart-container[data-project-id=\"\\${projectId}\"] .trend-btn\\`).forEach(b => {\n        b.className = 'trend-btn text-xs px-3 py-1 rounded-full border border-gray-300 text-gray-600 hover:bg-gray-100 transition-colors';\n      });\n      btn.className = 'trend-btn text-xs px-3 py-1 rounded-full bg-primary-600 text-white';\n      initTrendChart(projectId, Number(btn.dataset.days));\n    });\n  });\n\n  // Load Chart.js from CDN if not already loaded, then init\n  function boot() {\n    if (window.Chart) {\n      initTrendChart(projectId, 30);\n    } else {\n      const s = document.createElement('script');\n      s.src = 'https://cdn.jsdelivr.net/npm/chart.js@4/dist/chart.umd.min.js';\n      s.onload = () => initTrendChart(projectId, 30);\n      document.head.appendChild(s);\n    }\n  }\n\n  if (document.readyState === 'loading') {\n    document.addEventListener('DOMContentLoaded', boot);\n  } else {\n    boot();\n  }\n})();<\/script>"])), maybeRenderHead(), addAttribute(projectId, "data-project-id"), projectName, addAttribute(`stars-chart-${projectId}`, "id"), addAttribute(`forks-chart-${projectId}`, "id"), addAttribute(`chart-status-${projectId}`, "id"), defineScriptVars({ projectId }));
}, "/root/g/tishi/web/src/components/TrendChart.astro", void 0);

const $$Astro = createAstro("https://tishi.dev");
const $$id = createComponent(async ($$result, $$props, $$slots) => {
  const Astro2 = $$result.createAstro($$Astro, $$props, $$slots);
  Astro2.self = $$id;
  const { id } = Astro2.params;
  let project = null;
  let error = null;
  try {
    if (id) {
      const res = await getProject(Number(id));
      project = res.data;
    }
  } catch (e) {
    error = "\u9879\u76EE\u672A\u627E\u5230";
  }
  function formatNumber(n) {
    if (n >= 1e3) return `${(n / 1e3).toFixed(1)}k`;
    return String(n);
  }
  return renderTemplate`${renderComponent($$result, "BaseLayout", $$BaseLayout, { "title": project?.full_name || "\u9879\u76EE\u8BE6\u60C5" }, { "default": async ($$result2) => renderTemplate`${error || !project ? renderTemplate`${maybeRenderHead()}<div class="card text-center text-gray-500 py-12"> <p class="text-lg">${error || "\u9879\u76EE\u4E0D\u5B58\u5728"}</p> <a href="/" class="mt-4 inline-block text-primary-600 hover:underline">â† è¿”å›æ’è¡Œæ¦œ</a> </div>` : renderTemplate`<div> <a href="/" class="text-sm text-gray-500 hover:text-primary-600">â† è¿”å›æ’è¡Œæ¦œ</a> <div class="mt-4 card"> <div class="flex items-start justify-between"> <div> <h1 class="text-2xl font-bold text-gray-900">${project.full_name}</h1> ${project.description && renderTemplate`<p class="mt-2 text-gray-600">${project.description}</p>`} </div> ${project.rank != null && renderTemplate`<span class="badge-blue text-lg font-bold">#${project.rank}</span>`} </div> <div class="mt-6 flex flex-wrap gap-4"> <div class="text-center"> <div class="text-2xl font-bold text-yellow-500">â­ ${formatNumber(project.stars)}</div> <div class="text-xs text-gray-400">Stars</div> </div> <div class="text-center"> <div class="text-2xl font-bold text-gray-600">ğŸ´ ${formatNumber(project.forks)}</div> <div class="text-xs text-gray-400">Forks</div> </div> <div class="text-center"> <div class="text-2xl font-bold text-green-600">ğŸ“Š ${project.score.toFixed(1)}</div> <div class="text-xs text-gray-400">è¯„åˆ†</div> </div> ${project.language && renderTemplate`<div class="text-center"> <div class="text-2xl font-bold text-blue-600">ğŸ’» ${project.language}</div> <div class="text-xs text-gray-400">è¯­è¨€</div> </div>`} </div> ${project.topics && project.topics.length > 0 && renderTemplate`<div class="mt-6 flex flex-wrap gap-2"> ${project.topics.map((topic) => renderTemplate`<span class="badge-green">${topic}</span>`)} </div>`} <div class="mt-6 flex gap-3"> <a${addAttribute(project.github_url || `https://github.com/${project.full_name}`, "href")} target="_blank" rel="noopener" class="inline-flex items-center gap-2 rounded-lg bg-gray-900 px-4 py-2 text-sm font-medium text-white hover:bg-gray-700 transition-colors">
GitHub â†’
</a> </div> </div> <!-- Trend Chart --> <div class="mt-6 card"> ${renderComponent($$result2, "TrendChart", $$TrendChart, { "projectId": project.id, "projectName": project.full_name })} </div> </div>`}` })}`;
}, "/root/g/tishi/web/src/pages/projects/[id].astro", void 0);

const $$file = "/root/g/tishi/web/src/pages/projects/[id].astro";
const $$url = "/projects/[id]";

const _page = /*#__PURE__*/Object.freeze(/*#__PURE__*/Object.defineProperty({
  __proto__: null,
  default: $$id,
  file: $$file,
  url: $$url
}, Symbol.toStringTag, { value: 'Module' }));

const page = () => _page;

export { page };
